<!DOCTYPE html>
<html lang="zh">

<head>
  <!-- Basic configuration -->
  <meta charset="UTF-8" />
  <title>英金社区 - 登录</title>
  <meta name="description" content="英金社区 - 登录" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
  <!-- Javascript -->
  <script src="/js/jquery.js"></script>
  <script src="/js/vue.js"></script>
  <script src="/js/md5.js"></script>
  <script src="/js/qrcode.js"></script>
  <script src="/main.js"></script>
  <!-- Stylesheet -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/index.css" />
</head>

<body>

  <style>
    #qrcode img {
      width: 128px;
      height: 128px;
    }
    .goback{
      display: block;
      position: fixed;
      width:50px;
      height:50px;
      background-color: #fff;
      border-radius: 25px;
      top:25px;
      left:25px;
      -webkit-box-shadow: 0 4px 8px 0 var(--Shadow);
      box-shadow: 0 4px 8px 0 var(--Shadow);
    }
    .goback a{
      width:100%;
      height:100%;
      display: flex;
      text-align: center;
      justify-content: center;
      align-items: center;
    }
    .goback a i{
      font-size:22px;
    }
  </style>
  <div id="app">
    
    <div class="goback">
      <a href="javascript:location.href=mx.Api.GetQueryString('url')">
        <i class="iconfont icon-back"></i>
      </a>
    </div>


    <div class="page">
      <div class="login-box">
        <h2 class="login-title">登 录</h2>
        <div class="login-box-root">
          <div class="login-img-root">
            <div id="qrcode">
              <div id="sx" style="display: none;">
                <span class="sdw">该二维码已失效</span><br>
                <a href="javascript:;">重新加载</a>
              </div>
            </div>
            <h3>使用微信扫码登陆</h3>
          </div>
          <form class="login-root">
            <div class="login-input-box">
              <input placeholder="用户名" autocomplete="" class="login-input" id="username" type="text" name="username">
            </div>
            <div class="login-input-box">
              <input placeholder="密码" autocomplete="" class="login-input" id="password" type="password" name="password">
            </div>

            <div class="login-input-box">
              <a class="login-input-btn" id="login-button">登录</a>
            </div>

            <div class="login-input-box">
              <a href="/reg/" id="reg-btn" class="text-a line">注册</a>
              <a href="javascript:mx.alert('提示','好好想想！',false);" class="text-a line">忘记密码</a>
              <a href="/tkxy.html" class="text-a">服务协议</a>
            </div>
          </form>
        </div>
      </div>
      <div class="login-footer">
        <p>©2021 英金信息技术有限公司</p>
      </div>
    </div>
  </div>

  <script>
    if(mx.Api.GetQueryString("author") == "reg"){
      console.log("[Login Pattern]","reg")
      $(".login-title").text("注 册")
      $("#login-button").text("注册")
      $("#reg-btn").text("登录")
    } else {
      console.log("[Login Pattern]","default")
      if(mx.Api.GetQueryString("k")){
      var k = localStorage.getItem("userinfo");
      if(k == "fail"){
        mx.alert("提示","用户名或密码错误");
      }else if(k){
        mx.alert("提示","登陆成功",false,function(){
          if(mx.Api.GetQueryString("url")){
            location.href = mx.Api.GetQueryString("url")
          }
        });
      }else{
        mx.alert("提示","登陆失败")
      }
    } else{
      var k = localStorage.getItem("userinfo");
      if(k == "fail"){
        mx.alert("提示","用户名或密码错误");
      }else if(k){
        mx.alert("提示","您已登录，是否仍要登录？",true,function(){},function(){
          location.href = mx.Api.GetQueryString("url")
        },"继续登录","返回")
      }
    }
    var qrcode = new QRCode("qrcode");
    qrcode.makeCode(mx.Api.getRandomString(100))
    $("#login-button").click(function () {
      var username = $("#username").val();
      var password = $("#password").val();
      if (username == "" || password == "") {
        mx.alert("提示","用户名或密码不能为空！")
      }
      else if (mx.Api.checksSpecialCharator(username) || mx.Api.checksSpecialCharator(password)) {
        mx.alert("提示","用户名或密码不能含有非法字符！\n如!@#$%^&*()_+等");
      }
      else {
        var url =  mx.Api.GetQueryString("url")
        location.href = "/Api/login.htm?u=" + md5(username) + "&p=" + md5(password) + "&k=md5&i=citri&l=" +"/login/" + "&url=" + url
      }
    })
    }
  </script>
</body>

</html>